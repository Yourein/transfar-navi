# データとファイル

乗り換え情報の計算のために、以下の5つの情報を用いている

- Station
- Timetable
- Departure Pattern
- Calendar
- Ride

以下、乗り換えの情報が計算されるフローを示す。

1. 駅情報(Station)が読まれる。
2. 駅IDからその駅に対応する時刻表(Timetable)が読まれる。
3. 現在有効なカレンダーを取得する
4. カレンダーに記されている曜日情報や特別ダイヤ日などに基づき、どの発車パターンを利用するか決定する
5. 発車パターンとパターンの中のride_idにより、どの系統が運行するかがわかる (駅の発車時刻表がわかる)
6. 発車待ちのもののride_idから運行路の情報を得る
7. 運行路の各駅についてまたカレンダーを取得し、有効な乗り換え(※)ができるか判定する
8. 有効な乗り換えを当該の便に紐づける

## ※: 有効な乗り換え

有効な乗り換えとは、以下を満たす乗り換えである。

- 戻らない
- 今乗っているものと同じところにいかない
- 路線を共有しているものは路線が切り替わるところから乗り換えるようにする
  - 55G→55Aは亀田支所前で乗り換えるみたいな